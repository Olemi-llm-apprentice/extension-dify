# タスクリスト（進捗・課題管理）

## ✅ 完了したタスク

### 基本機能実装
- ✅ Chrome拡張機能の基本構造作成（manifest.json、ディレクトリ構造）
- ✅ サイドバー表示機能の実装
- ✅ ポップアップ表示機能の実装  
- ✅ DifyアプリのURL設定機能の実装
- ✅ ホワイトリスト/ブラックリスト機能の実装

### バグ修正・改善
- ✅ フローティングボタンからサイドパネルが開かない問題を修正
  → background.jsにメッセージリスナーを追加
- ✅ フローティングボタンをドラッグ可能にする機能を追加
  → 画面内での自由移動が可能
- ✅ background.jsのエラー修正（ユーザージェスチャー制限対応）
  → 2段階プロセス：コンテンツ抽出 → 手動でサイドパネル開く
- ✅ メッセージパッシングの問題を修正
  → 非同期処理とエラーハンドリングを改善

### コンテンツ抽出機能
- ✅ デフォルトのコンテンツ抽出をbody全文へ変更
  → 不要要素（広告、ナビ、フッター等）を自動除外
- ✅ 上級者設定でカスタムセレクタ指定機能を実装
- ✅ コンテンツ抽出の動作を明確化・改善
  → 抽出方法と文字数をツールチップで表示
- ✅ サイドパネルでのコンテンツ表示機能を追加
  → プレビュー表示、クリップボード自動コピー

### ユーザーエクスペリエンス改善
- ✅ 包括的なデバッグ機能追加（全メッセージフローにログ）
- ✅ 視覚的フィードバック強化
  → ボタン状態変化、通知表示、Difyアプリハイライト
- ✅ 手動ペースト用のUX改善
  → Ctrl+Vヒント表示、詳細な操作指示

## 📋 現在の動作フロー

### コンテンツ抽出フロー
1. **長押し（800ms）** → ページ内容をbody全体から抽出
2. **フローティングボタンが📋に変化** （緑色）
3. **ツールチップ表示**: "💬ボタンをクリックしてサイドパネルを開いてください"
4. **ユーザーがボタンクリック** → サイドパネルが開く
5. **コンテンツプレビュー表示** + **自動クリップボードコピー**
6. **Difyアプリがハイライト** + **"Ctrl+V でペースト"ヒント表示**
7. **ユーザーがDifyアプリでCtrl+V** → 完了

### フローティングボタン操作
- **短押し（クリック）**: サイドパネルを開く
- **長押し（800ms以上）**: コンテンツを抽出
- **ドラッグ**: ボタンを画面内で自由に移動

## 🔍 技術的制限・課題

### Difyアプリへの自動入力について
- ❌ **iframe内への直接入力は技術的に困難**
  - Same-Origin Policy制限
  - CORS制限  
  - クロスオリジンiframeアクセス禁止
- ✅ **現在の解決策**: クリップボード経由 + 手動ペースト
  - 100%確実に動作
  - 明確なビジュアルガイド
  - 2クリック + Ctrl+Vで完了

## 📝 今後の機能予定

- [ ] 過去のチャット履歴の保存・検索
- [ ] サイトごとに異なるDifyアプリを割り当て
- [ ] 右クリックコンテキストメニュー
- [ ] ショートカットキーによる即時起動
- [ ] ダークモード対応
- [ ] 選択テキストのみ抽出機能

---

## 📋 開発・更新ルール

**ドキュメント更新ルール:**
- 機能追加・変更時は自動的にTASKS.mdとREADME.mdを更新
- コミット時に必要に応じてドキュメントを同期更新
- 新機能は「完了したタスク」に追加
- 操作フローに変更があれば「現在の動作フロー」を更新